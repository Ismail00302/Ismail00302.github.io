// =======================================================
//   AI ENGINE 3.0 ULTRA ‚Äî –ò–ù–¢–ï–õ–õ–ï–ö–¢ –î–õ–Ø "–¢–ï–¢–†–ê–ë–£–ú"
//   –†–µ–∂–∏–º—ã: A (–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç), B (–¥–∏–∞–ª–æ–≥), C (–ø–æ–∏—Å–∫),
//           D (ULTRA ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)
//   –°—Ç–∏–ª—å: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã
//   –ü–∞–º—è—Ç—å: –¥–æ 40 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
// =======================================================

// ---------------- –ù–ê–°–¢–†–û–ô–ö–ò ----------------------------

let AI_MODE = "D";              // –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Å–∞–º—ã–π —É–º–Ω—ã–π
const AI_MAX_MEMORY = 40;       // –•—Ä–∞–Ω–∏–º –¥–æ 40 —Å–æ–æ–±—â–µ–Ω–∏–π
let aiMemory = [];              // [{role: "user"|"assistant", text: "..."}]

// ================== –£–¢–ò–õ–ò–¢–´ =============================
// ===============================
//   –û–¢–ö–†–´–¢–ò–ï –ß–ê–¢-–ë–û–¢–ê –° –ú–û–ë–ò–õ–¨–ù–û–ô –ö–ù–û–ü–ö–ò
// ===============================
document.addEventListener("DOMContentLoaded", () => {
    const aiBtn = document.getElementById("openMobileAI");
    const chatbot = document.getElementById("chatbot");

    if (aiBtn) {
        aiBtn.addEventListener("click", () => {
            chatbot.classList.remove("chatbot-hidden");
        });
    }
});

// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞
function ai_getProducts() {
    return typeof products !== "undefined" ? products : [];
}

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä–∑–∏–Ω–µ
function ai_getCart() {
    return typeof cart !== "undefined" ? cart : [];
}

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–º—É
function ai_getFavorites() {
    return typeof favorites !== "undefined" ? favorites : [];
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç—å
function ai_remember(role, text) {
    aiMemory.push({ role, text: text.toLowerCase() });
    if (aiMemory.length > AI_MAX_MEMORY) {
        aiMemory.shift();
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞
function ai_has(text, arr) {
    return arr.some(w => text.includes(w));
}

// –î–æ—Å—Ç–∞—Ç—å —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞ (–¥–ª—è —Ü–µ–Ω—ã / –±—é–¥–∂–µ—Ç–∞)
function ai_extractNumber(text) {
    const match = text.match(/\d+/g);
    if (!match || !match.length) return null;
    return Number(match[match.length - 1]);
}

// –ê–∫–∫—É—Ä–∞—Ç–Ω—ã–π –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—é
function ai_detectGoalCategory(text) {
    const t = text.toLowerCase();

    if (ai_has(t, ["—à–∫–æ–ª", "–∫–ª–∞—Å—Å", "—É—á–µ–Ω–∏–∫", "—É—á–µ–±–Ω–∏–∫"]))
        return "school";

    if (ai_has(t, ["—Å—Ç—É–¥–µ–Ω—Ç", "—É–Ω–∏–≤–µ—Ä", "–ø–∞—Ä—ã", "—Å–µ—Å—Å–∏—è"]))
        return "student";

    if (ai_has(t, ["–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç", "–¥–æ–∫—É–º–µ–Ω—Ç", "–æ—Ñ–∏—Å–Ω—ã–π"]))
        return "office";

    if (ai_has(t, ["—Ä–∏—Å–æ–≤–∞–Ω", "—Ç–≤–æ—Ä—á", "—Ö—É–¥–æ–∂", "–∞—Ä—Ç", "—Å–∫–µ—Ç—á"]))
        return "artist";

    if (ai_has(t, ["–¥–∏–∑–∞–π–Ω", "–º–∞–∫–µ—Ç", "—Å–∫–µ—Ç—á–±—É–∫"]))
        return "design";

    if (ai_has(t, ["—á–µ—Ä—Ç–µ–∂", "–º–∞—Ç–µ–º", "–≥–µ–æ–º–µ—Ç—Ä"]))
        return "math";

    if (ai_has(t, ["–µ–≥—ç", "—ç–∫–∑–∞–º", "–∑–Ω–æ", "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞"]))
        return "exam";

    if (ai_has(t, ["pro", "–ø—Ä–æ—Ñ", "–ø—Ä–µ–º–∏—É–º", "—Ç–æ–ø"]))
        return "pro";

    return null;
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏: —à–∫–æ–ª–∞ / –æ—Ñ–∏—Å / —ç–∫–∑–∞–º–µ–Ω / —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ / –ø–æ–¥–∞—Ä–æ–∫ / —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π
function ai_detectGoalText(text) {
    const t = text.toLowerCase();

    if (ai_has(t, ["—à–∫–æ–ª", "–∫–ª–∞—Å—Å", "—É—á–µ–Ω–∏–∫"])) return "—à–∫–æ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä";
    if (ai_has(t, ["—Å—Ç—É–¥–µ–Ω—Ç", "—É–Ω–∏–≤–µ—Ä"]))       return "–Ω–∞–±–æ—Ä —Å—Ç—É–¥–µ–Ω—Ç–∞";
    if (ai_has(t, ["–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç"]))          return "–æ—Ñ–∏—Å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç";
    if (ai_has(t, ["—Ä–∏—Å–æ–≤–∞–Ω", "—Ö—É–¥–æ–∂", "—Ç–≤–æ—Ä—á"])) return "–Ω–∞–±–æ—Ä –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞";
    if (ai_has(t, ["–µ–≥—ç", "—ç–∫–∑–∞–º"]))           return "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º";
    if (ai_has(t, ["–ø–æ–¥–∞—Ä", "–ø–æ–¥–∞—Ä–æ–∫"]))       return "–ø–æ–¥–∞—Ä–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä";

    return "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–∞–Ω—Ü—Ç–æ–≤–∞—Ä–æ–≤";
}

// –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É (–∑–∞–≥–æ–ª–æ–≤–æ–∫ + –æ–ø–∏—Å–∞–Ω–∏–µ + –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
function ai_semanticSearch(queryText) {
    const q = queryText.toLowerCase().trim();
    if (!q) return [];

    const result = [];

    for (const p of ai_getProducts()) {
        const title = (p.title || "").toLowerCase();
        const desc  = (p.desc  || "").toLowerCase();
        const cat   = (p.category || "").toLowerCase();

        let score = 0;

        if (title.includes(q)) score += 6;
        if (desc.includes(q))  score += 4;
        if (cat.includes(q))   score += 2;

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ —Å–ª–æ–≤–∞–º
        const words = q.split(/\s+/).filter(Boolean);
        for (const w of words) {
            if (w.length < 3) continue;
            if (title.includes(w)) score += 2;
            if (desc.includes(w))  score += 1;
        }

        if (score > 0) {
            result.push({ product: p, score });
        }
    }

    return result.sort((a, b) => b.score - a.score).map(r => r.product);
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
function ai_price(num) {
    return typeof formatPrice === "function"
        ? formatPrice(num)
        : (num + " ‚ÇΩ");
}

// –ö—Ä–∞—Å–∏–≤–æ–µ –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function ai_catName(cat) {
    if (typeof translateCategory === "function") {
        return translateCategory(cat);
    }
    return cat || "–†–∞–∑–Ω–æ–µ";
}

// ================== –†–ï–ñ–ò–ú A ‚Äî –ö–û–ù–°–£–õ–¨–¢–ê–ù–¢ =================

function ai_modeA(text) {
    const t = text.toLowerCase();

    if (ai_has(t, ["–ø—Ä–∏–≤–µ—Ç", "—Å–∞–ª–∞–º", "–∑–¥—Ä–∞—Å—Ç–≤", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ"])) {
        return [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞ ¬´–¢–µ—Ç—Ä–∞–±—É–º¬ª.",
            "–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–æ–¥–±–æ—Ä–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —à–∫–æ–ª—ã, —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞, –æ—Ñ–∏—Å–∞, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –∏–ª–∏ —ç–∫–∑–∞–º–µ–Ω–æ–≤.",
            "–û–ø–∏—à–∏—Ç–µ, –¥–ª—è –∫–æ–≥–æ –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –∏ –Ω–∞ –∫–∞–∫—É—é —Å—É–º–º—É –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—Ç–µ—Å—å."
        ].join(" ");
    }

    if (ai_has(t, ["—à–∫–æ–ª", "–∫–ª–∞—Å—Å", "—É—á–µ–Ω–∏–∫"])) {
        return [
            "–î–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞ –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω—ã –±–∞–∑–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏: —Ç–µ—Ç—Ä–∞–¥–∏, —Ä—É—á–∫–∏, –ø—Ä–æ—Å—Ç–æ–π –∫–∞—Ä–∞–Ω–¥–∞—à, –ª–∏–Ω–µ–π–∫–∞, –ª–∞—Å—Ç–∏–∫, –º–∞—Ä–∫–µ—Ä—ã –∏ –ø–∞–ø–∫–∞ –¥–ª—è –±—É–º–∞–≥.",
            "–ï—Å–ª–∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç–µ –∫–ª–∞—Å—Å –∏ –ø—Ä–µ–¥–º–µ—Ç—ã, —è —Å–º–æ–≥—É —Å–æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å."
        ].join(" ");
    }

    if (ai_has(t, ["—Å—Ç—É–¥–µ–Ω—Ç", "—É–Ω–∏–≤–µ—Ä", "–ø–∞—Ä—ã", "—Å–µ—Å—Å–∏—è"])) {
        return [
            "–î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ–¥–æ–π–¥—É—Ç: —É–¥–æ–±–Ω—ã–π –±–ª–æ–∫–Ω–æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ A5 –∏–ª–∏ A4, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã, –Ω–∞–¥—ë–∂–Ω—ã–µ —Ä—É—á–∫–∏, –ø–∞–ø–∫–∞ –∏–ª–∏ –æ—Ä–≥–∞–Ω–∞–π–∑–µ—Ä, —Å—Ç–∏–∫–µ—Ä—ã –¥–ª—è –ø–æ–º–µ—Ç–æ–∫.",
            "–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω–∏–∫, –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–∞–µ—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å."
        ].join(" ");
    }

    if (ai_has(t, ["–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç", "–¥–æ–∫—É–º–µ–Ω—Ç"])) {
        return [
            "–î–ª—è –æ—Ñ–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã: –±—É–º–∞–≥–∞ A4, –ø–∞–ø–∫–∏-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã, –ø–æ–¥—Å—Ç–∞–≤–∫–∞ –¥–ª—è –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∏, —Å—Ç–µ–ø–ª–µ—Ä —Å–æ —Å–∫–æ–±–∞–º–∏, –±–ª–æ–∫–∏ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ –∏ –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä —Ä—É—á–µ–∫.",
            "–ï—Å–ª–∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–µ—Ä–µ—Å—ã–ª–∫–∞, –∞—Ä—Ö–∏–≤), –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ—á–Ω–µ–µ."
        ].join(" ");
    }

    if (ai_has(t, ["—Ä–∏—Å–æ–≤–∞–Ω", "—Ç–≤–æ—Ä—á", "—Ö—É–¥–æ–∂", "–∞—Ä—Ç", "—Å–∫–µ—Ç—á"])) {
        return [
            "–î–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –ø–æ–ª–µ–∑–Ω—ã: –∞–ª—å–±–æ–º –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è, –∫–∏—Å—Ç–∏, —Ü–≤–µ—Ç–Ω—ã–µ –∫–∞—Ä–∞–Ω–¥–∞—à–∏, —Ñ–ª–æ–º–∞—Å—Ç–µ—Ä—ã –∏ –∫—Ä–∞—Å–∫–∏ (–∞–∫–≤–∞—Ä–µ–ª—å –∏–ª–∏ –≥—É–∞—à—å).",
            "–î–∞–π—Ç–µ –∑–Ω–∞—Ç—å, –¥–ª—è –∫–∞–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –Ω–∞—á–∞–ª—å–Ω—ã–π, –ª—é–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∏–ª–∏ –±–ª–∏–∂–µ –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É, –∏ —è –ø—Ä–µ–¥–ª–æ–∂—É –Ω—É–∂–Ω—ã–π –Ω–∞–±–æ—Ä."
        ].join(" ");
    }

    if (ai_has(t, ["–µ–≥—ç", "—ç–∫–∑–∞–º", "–∑–Ω–æ"])) {
        return [
            "–î–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º –æ–±—ã—á–Ω–æ –±–µ—Ä—É—Ç: —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è, –±–ª–æ–∫–Ω–æ—Ç –∏–ª–∏ —Ç–µ—Ç—Ä–∞–¥—å –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤, –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤, –∑–∞–∫–ª–∞–¥–∫–∏ –∏ —Å—Ç–∏–∫–µ—Ä—ã.",
            "–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π ¬´—ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã–π¬ª –Ω–∞–±–æ—Ä."
        ].join(" ");
    }

    if (ai_has(t, ["–ø–æ–¥–∞—Ä", "–ø–æ–¥–∞—Ä–æ–∫"])) {
        return [
            "–î–ª—è –ø–æ–¥–∞—Ä–∫–∞ —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥—è—Ç –Ω–∞–±–æ—Ä—ã PRO, –∫—Ä–∞—Å–∏–≤—ã–µ –±–ª–æ–∫–Ω–æ—Ç—ã, –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ —Ä—É—á–∫–∏, —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–ª–∏ –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –Ω–∞–±–æ—Ä—ã.",
            "–°–æ–æ–±—â–∏—Ç–µ –±—é–¥–∂–µ—Ç –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã —á–µ–ª–æ–≤–µ–∫–∞, –∏ —è –ø—Ä–µ–¥–ª–æ–∂—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤."
        ].join(" ");
    }

    return "–û–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∑–∞–¥–∞—á—É: –¥–ª—è –∫–æ–≥–æ –∏–º–µ–Ω–Ω–æ –∏ –ø–æ–¥ –∫–∞–∫—É—é —Ü–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã. –¢–æ–≥–¥–∞ —è —Å–º–æ–≥—É –¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.";
}

// ============= –†–ï–ñ–ò–ú B ‚Äî –î–ò–ê–õ–û–ì / –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–Ø ============

function ai_modeB(text) {
    const t = text.toLowerCase();
    ai_remember("user", text);

    if (ai_has(t, ["–ø—Ä–∏–≤–µ—Ç", "—Å–∞–ª–∞–º"])) {
        return "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ ¬´–¢–µ—Ç—Ä–∞–±—É–º¬ª. –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ø–æ–¥–±–æ—Ä–æ–º –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∏ –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —Å–∞–π—Ç.";
    }

    if (ai_has(t, ["–∫–∞–∫ –¥–µ–ª–∞", "–∫–∞–∫ —Ç—ã"])) {
        return "–†–∞–±–æ—Ç–∞—é –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –≤–∞—à–∏–º –≤–æ–ø—Ä–æ—Å–∞–º üôÇ";
    }

    if (ai_has(t, ["—Å–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä"])) {
        return "–†–∞–¥, —á—Ç–æ —Å–º–æ–≥ –ø–æ–º–æ—á—å. –ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–æ–≤–∞—Ä–∞–º –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É —Å–∞–π—Ç–∞ ‚Äî –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å.";
    }

    if (ai_has(t, ["–∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å", "–∫–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å", "–æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"])) {
        return [
            "–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑: –¥–æ–±–∞–≤—å—Ç–µ –Ω—É–∂–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ó–∞–∫–∞–∑¬ª.",
            "–í —Ñ–æ—Ä–º–µ —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏. –ù–∞ —Å–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—á–µ–±–Ω—ã–π, –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è."
        ].join(" ");
    }

    if (ai_has(t, ["–∫–æ—Ä–∑–∏–Ω"])) {
        if (typeof analyzeCartForAI === "function" && ai_getCart().length > 0) {
            return analyzeCartForAI(true);
        }
        if (!ai_getCart().length) {
            return "–°–µ–π—á–∞—Å –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, –∏ —è —Å–º–æ–≥—É –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä.";
        }
    }

    return [
        "–Ø –≤–∞—Å —É—Å–ª—ã—à–∞–ª. –Ø –º–æ–≥—É:",
        "‚Ä¢ –ø–æ–¥–æ–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä –ø–æ —Ü–µ–ª–∏ (—à–∫–æ–ª–∞, —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, –æ—Ñ–∏—Å, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —ç–∫–∑–∞–º–µ–Ω—ã, –ø–æ–¥–∞—Ä–æ–∫);",
        "‚Ä¢ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ —Ä–∞–º–∫–∞—Ö —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞;",
        "‚Ä¢ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É –∏ —É–∫–∞–∑–∞—Ç—å, —á–µ–≥–æ –≤ –Ω–µ–π –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç.",
        "–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –∏ —è —Å—Ñ–æ—Ä–º–∏—Ä—É—é —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç."
    ].join(" ");
}

// ============= –†–ï–ñ–ò–ú C ‚Äî –£–ú–ù–´–ô –ü–û–ò–°–ö –ü–û –ö–ê–¢–ê–õ–û–ì–£ =========

function ai_modeC(text) {
    const items = ai_semanticSearch(text);

    if (!items.length) {
        return "–ü–æ –¥–∞–Ω–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∞—á–µ –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ä—É—á–∫–∞, —Ç–µ—Ç—Ä–∞–¥—å, –º–∞—Ä–∫–µ—Ä).";
    }

    if (items.length === 1) {
        const p = items[0];
        return [
            "–£–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –æ–¥–∏–Ω –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–æ–≤–∞—Ä:",
            `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (–∫–∞—Ç–µ–≥–æ—Ä–∏—è: ${ai_catName(p.category)})`,
            "",
            "–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —è –º–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å, —á–µ–º –µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∏–ª–∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã."
        ].join("\n");
    }

    let txt = "–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞:\n\n";
    items.slice(0, 7).forEach(p => {
        txt += `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (${ai_catName(p.category)})\n`;
    });
    txt += "\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å (—à–∫–æ–ª–∞, –æ—Ñ–∏—Å, —ç–∫–∑–∞–º–µ–Ω—ã), —á—Ç–æ–±—ã —Å—É–∑–∏—Ç—å –≤—ã–±–æ—Ä.";

    return txt;
}

// ============= –†–ï–ñ–ò–ú D ‚Äî ULTRA (–ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê) ===

function ai_modeD(text) {
    const t = text.toLowerCase();
    ai_remember("user", text);

    const goalCat  = ai_detectGoalCategory(t);
    const goalText = ai_detectGoalText(t);
    const budget   = ai_extractNumber(t);
    const cartNow  = ai_getCart();

    // 1. –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    if (ai_has(t, ["–∫–æ—Ä–∑–∏–Ω", "–∞–Ω–∞–ª–∏–∑", "—á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "—á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å"])) {
        if (typeof analyzeCartForAI === "function") {
            return analyzeCartForAI(true);
        }
        if (!cartNow.length) {
            return "–ö–æ—Ä–∑–∏–Ω–∞ —Å–µ–π—á–∞—Å –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, –∏ —è —Å–º–æ–≥—É –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä.";
        }
    }

    // 2. –ó–∞–ø—Ä–æ—Å –≤–∏–¥–∞ "—Å–æ–±–µ—Ä–∏ –Ω–∞–±–æ—Ä / –ø–æ–¥–±–µ—Ä–∏"
    if (ai_has(t, ["—Å–æ–±–µ—Ä–∏", "–ø–æ–¥–±–µ—Ä–∏", "–Ω–∞–±–æ—Ä", "–∫–æ–º–ø–ª–µ–∫—Ç"])) {
        const products = ai_getProducts().slice();
        let filtered = products;

        if (goalCat) {
            filtered = filtered.filter(p => p.category === goalCat);
        }

        if (budget) {
            filtered = filtered.filter(p => p.price <= budget);
        }

        // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∞—è ‚Äì —Å–ª–µ–≥–∫–∞ –æ—Å–ª–∞–±–ª—è–µ–º
        if (!filtered.length) {
            filtered = products.filter(p => goalCat ? p.category === goalCat : true);
        }

        filtered.sort((a, b) => a.price - b.price);

        // –†–∞–∑–º–µ—Ä –Ω–∞–±–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±—é–¥–∂–µ—Ç–∞
        let count = 7;
        if (budget && budget < 200) count = 4;
        else if (budget && budget > 800) count = 10;

        const selected = filtered.slice(0, count);

        if (!selected.length) {
            return "–°–µ–π—á–∞—Å —è –Ω–µ –º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –Ω–∞–±–æ—Ä –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–µ–º–Ω–æ–≥–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.";
        }

        let sum = 0;
        selected.forEach(p => sum += p.price);

        let answer = `–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π ${goalText}.\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–æ–∑–∏—Ü–∏–∏:\n`;
        selected.forEach(p => {
            answer += `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (${ai_catName(p.category)})\n`;
        });

        answer += `\n–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—É–º–º–∞ –Ω–∞–±–æ—Ä–∞: ${ai_price(sum)}. `;
        if (budget) {
            answer += `–í—ã —É–∫–∞–∑–∞–ª–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä –æ–∫–æ–ª–æ ${budget} ‚ÇΩ ‚Äî –Ω–∞–±–æ—Ä —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –≤ —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω. `;
        }

        answer += "–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –Ω–∞–±–æ—Ä ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å, –∫–∞–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å.";

        return answer;
    }

    // 3. –ü–æ–¥–∞—Ä–∫–∏
    if (ai_has(t, ["–ø–æ–¥–∞—Ä", "–ø–æ–¥–∞—Ä–æ–∫"])) {
        const products = ai_getProducts();

        let filtered = products.filter(p =>
            ai_has((p.title || "").toLowerCase(), ["–Ω–∞–±–æ—Ä", "pro", "–ø—Ä–µ–º–∏—É–º", "premium"]) ||
            ai_has((p.desc || "").toLowerCase(),  ["–ø–æ–¥–∞—Ä", "–ø–æ–¥–∞—Ä–æ–∫"])
        );

        if (!filtered.length) filtered = products.filter(p => p.category === "pro");

        if (!filtered.length) filtered = products;

        filtered.sort((a, b) => b.price - a.price);

        if (budget) {
            filtered = filtered.filter(p => p.price <= budget);
            if (!filtered.length) filtered = products.filter(p => p.price <= budget);
        }

        const shown = filtered.slice(0, 6);

        let ans = "–ö–∞–∫ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏:\n\n";
        shown.forEach(p => {
            ans += `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (${ai_catName(p.category)})\n`;
        });

        ans += "\n–î–ª—è –ø–æ–¥–∞—Ä–∫–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã ‚Äî –æ–Ω–∏ –ª—É—á—à–µ —Å–º–æ—Ç—Ä—è—Ç—Å—è –ø—Ä–∏ –≤—Ä—É—á–µ–Ω–∏–∏.";
        return ans;
    }

    // 4. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ —Ç–∏–ø—É —Ç–æ–≤–∞—Ä–∞
    const semantic = ai_semanticSearch(t);
    if (semantic.length === 1) {
        const p = semantic[0];
        return [
            "–°—É–¥—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–≤–∞—Ä:",
            "",
            `üîπ ${p.title}`,
            `üí∞ –¶–µ–Ω–∞: ${ai_price(p.price)}`,
            `üì¶ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${ai_catName(p.category)}`,
            "",
            "–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —è –º–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å, —á–µ–º –µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –∏–ª–∏ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)."
        ].join("\n");
    }

    if (semantic.length > 1 && semantic.length <= 7) {
        let txt = "–£–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤:\n\n";
        semantic.forEach(p => {
            txt += `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (${ai_catName(p.category)})\n`;
        });
        txt += "\n–£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –≤–∞–º –±–ª–∏–∂–µ ‚Äî –±–∞–∑–æ–≤—ã–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏–ª–∏ –±–ª–∏–∂–µ –∫ PRO-—É—Ä–æ–≤–Ω—é, –∏ —è –ø–æ–º–æ–≥—É —Å—É–∑–∏—Ç—å –≤—ã–±–æ—Ä.";
        return txt;
    }

    if (semantic.length > 7) {
        let txt = "–¢–æ–≤–∞—Ä—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∞–π–¥–µ–Ω—ã. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:\n\n";
        semantic.slice(0, 7).forEach(p => {
            txt += `‚Ä¢ ${p.title} ‚Äî ${ai_price(p.price)} (${ai_catName(p.category)})\n`;
        });
        txt += "\n–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—é–¥–∂–µ—Ç–Ω—ã–µ, —Ç–æ–ª—å–∫–æ PRO –ª–∏–±–æ —Ç–æ–ª—å–∫–æ —à–∫–æ–ª—å–Ω—ã–µ/—Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.";
        return txt;
    }

    // 5. Fallback ‚Äî –æ–±—â–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    return [
        "–Ø –≤–∞—Å –ø–æ–Ω—è–ª. –í –æ–±—â–∏—Ö —á–µ—Ä—Ç–∞—Ö —è –º–æ–≥—É:",
        "‚Ä¢ –ø–æ–¥–æ–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ü–µ–ª—å (—à–∫–æ–ª–∞, —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, –æ—Ñ–∏—Å, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —ç–∫–∑–∞–º–µ–Ω—ã, –ø–æ–¥–∞—Ä–æ–∫);",
        "‚Ä¢ —É–ª–æ–∂–∏—Ç—å—Å—è –≤ –∑–∞–¥–∞–Ω–Ω—ã–π –±—é–¥–∂–µ—Ç (–µ—Å–ª–∏ —É–∫–∞–∂–µ—Ç–µ —Å—É–º–º—É);",
        "‚Ä¢ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à—É –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç;",
        "‚Ä¢ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.",
        "",
        "–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–ª—è –∫–æ–≥–æ –∏–º–µ–Ω–Ω–æ (—à–∫–æ–ª—å–Ω–∏–∫, —Å—Ç—É–¥–µ–Ω—Ç, –æ—Ñ–∏—Å–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —Ö—É–¥–æ–∂–Ω–∏–∫) –∏ –Ω–∞ –∫–∞–∫—É—é —Å—É–º–º—É –ø—Ä–∏–º–µ—Ä–Ω–æ, –∏ —è —Å—Ñ–æ—Ä–º–∏—Ä—É—é –ø–æ–¥—Ä–æ–±–Ω—ã–π, –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫."
    ].join("\n");
}

// ============= –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ß–ê–¢–ê ==================
//
// script.js –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å –µ—ë —á–µ—Ä–µ–∑ botReply():
// function botReply(text) { return ai_process(text); }
// ==========================================================

function ai_process(text) {
    const t = (text || "").trim();
    if (!t) return "–ü–æ–∫–∞ —è –Ω–µ –≤–∏–∂—É –≤–æ–ø—Ä–æ—Å–∞. –ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç.";

    // –ö–æ–º–∞–Ω–¥–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞: /mode A/B/C/D
    if (t.startsWith("/mode")) {
        const parts = t.split(/\s+/);
        const m = (parts[1] || "").toUpperCase();
        if (["A", "B", "C", "D"].includes(m)) {
            AI_MODE = m;
            return "–†–µ–∂–∏–º –ò–ò –ø–µ—Ä–µ–∫–ª—é—á—ë–Ω –Ω–∞: " + m;
        }
        return "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã –ò–ò: A ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, B ‚Äî –¥–∏–∞–ª–æ–≥, C ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º, D ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ULTRA —Ä–µ–∂–∏–º.";
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    ai_remember("user", t);

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º–∞–º
    if (AI_MODE === "A") return ai_modeA(t);
    if (AI_MODE === "B") return ai_modeB(t);
    if (AI_MODE === "C") return ai_modeC(t);
    if (AI_MODE === "D") return ai_modeD(t);

    // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π ‚Äî fallback
    return ai_modeD(t);
}
